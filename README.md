# patent_seeker

This pipeline is used to scrape protein sequences from a list of patents. It then processes them  to remove short and duplicated sequences, and runs multiple sequences alignments to assess similarity. Any above a specific sequence ID threshold are removed. Filtered sequences are then run through another round of MSA, and phylogenetic trees are generated. Outputs are provided as csv and fasta files.

It is currently designed to be run in Google Co-lab, and will not run as a standalone python script. I will fix this at somepoint...

The below code functions as a master script, but the individual models are available as stand-alone code if required.

Module 1 - Importing libraries and connecting google drive

Module 2 - Downloading patent databases
This will prompt the user as to whether or not to download the ebi patent databases from their ftp server, and save them to your google drive. You only need to do this once.

Module 3 - Patent Sequence Seeker
The script inputs a list of patent numbers once stripped of the preceding letters e.g. US, trailing version id (e.g. A1), and all and any punctuation (e.g. 2014/384930), using the cvs_patent_list_reformatter script. It will then search the EU, US, japanese and korean patent databases, grab any sequences from the patent numbers submitted, and save them to your google drive.

Module 4 - Faster combiner
This will take the individual patent fasta files produced from the above, and combine them into a single file.

Module 5 - Patent filter
This will parse the combined file from above, and remove any sequences below a specified length, eg 200 residues. It will also remove any duplicates, and has an input to remove specific sequence identifiers or patents not required. It will print an accurate number for the sequences originally loaded, and those in the final file, but the numbers it gives for the ones removed in each class are unreliable (again, I will fix this at some point).

Module 6 - Similarity filter
This runs a multiple sequence alignment of the filtered sequences from above, and runs a cut off at a specified similarity - the default is set to 95%. It then takes creates a new fasta file with the sequences which are less that 95% similar to each other, and performs the MSA again to confirm they all fall below the cutoff relative to each other.

Module 7 - Tree builder
This runs another MSA on the filtered sequences and builds a phylogenetic tree. It then has the option to split the tree into separate files at a specified number of branch points. For example, entering ‘2’ will split the original fasta file into two new ones at the first branch point (node1_branch1 and node1_branch2), then split each of these in turn to produce node1_branch1_node2_branch1 etc.

Module 8 - blastp (SLOW!)
This will take a fasta file input and run blastp. It will then print the top five hits for each sequence ID, and also save them to a csv, including the ncbi URLs of the hits. This works, but is EXTREMELY slow, ie it takes about 15 minutes per sequence, so not recommended unless you really need to. It does have a function to resume from where it left of if unexpected disconnected though.

Module 9 - NCBI scrapper (beta)
This module takes a list of NCBI links generated by the blastp scrip above, and searches them for particular words, in this case alpha, beta, and gamma. It is very much in beta and only picks up some instances so use with caution.
